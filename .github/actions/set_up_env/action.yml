name: 'Set up Environment'
description: 'Set up miniconda environment'
runs:
  using: "composite"
  steps:
    - name: Update environment
      shell: bash -l {0}
      run: |
        mamba env update -n metgem -f metgem/environment.yml
    - name: Install build dependencies
      shell: bash -l {0}
      run: |
        mamba env update -n metgem -f metgem/environment.dev.yml
        if [ "${{ runner.os }}" == "Windows" ]; then
            mamba install pywin32
        elif [ "${{ runner.os }}" == "Linux" ]; then
          sudo apt-get install -y libfuse2
        elif [ "${{ runner.os }}" == "macOS" ]; then
          npm install -g appdmg
        fi
    - name: Install Packaging dependencies
      shell: bash -l {0}
      run:  mamba env update -n metgem -f environment.packaging.yml
    - name: Conda info
      shell: bash -l {0}
      run: |
        conda info
        conda list
        conda config --show-sources
        conda config --show
